
//<![CDATA[

// a few things don't have var in front of them - they update already existing variables the game needs
lanesSide = 2;
patchesAhead = 7;
patchesBehind = 3;
trainIterations = 10000;

// the number of other autonomous vehicles controlled by your network
otherAgents = 3; // max of 9

var num_inputs = (lanesSide * 2 + 1) * (patchesAhead + patchesBehind);
var num_actions = 5;
var temporal_window = 5;
var network_size = num_inputs * temporal_window + num_actions * temporal_window + num_inputs;

var layer_defs = [];
layer_defs.push({type: 'input', out_sx: 1, out_sy: 1, out_depth: network_size});
layer_defs.push({type: 'fc', num_neurons: 1, activation: 'softmax'});
layer_defs.push({type: 'regression', num_neurons: num_actions});

var tdtrainer_options = {
    learning_rate: 0.01,
    momentum: 0,
    batch_size: 32,
    l2_decay: 0.001
};

var opt = {};
opt.temporal_window = temporal_window;
opt.experience_size = 10000;
opt.start_learn_threshold = 5000;
opt.gamma = 0.9;
opt.learning_steps_total = 10000;
opt.learning_steps_burnin = 1000;
opt.epsilon_min = 0.0;
opt.epsilon_test_time = 0.1;
opt.layer_defs = layer_defs;
opt.tdtrainer_options = tdtrainer_options;

brain = new deepqlearn.Brain(num_inputs, num_actions, opt);

learn = function (state, lastReward) 
{
brain.backward(lastReward);
var action = brain.forward(state);

draw_net();
draw_stats();

return action;
}

//]]>

/*###########*/
if (brain) {
brain.value_net.fromJSON({"layers":[{"out_depth":325,"out_sx":1,"out_sy":1,"layer_type":"input"},{"out_depth":1,"out_sx":1,"out_sy":1,"layer_type":"fc","num_inputs":325,"l1_decay_mul":0,"l2_decay_mul":1,"filters":[{"sx":1,"sy":1,"depth":325,"w":{"0":0.058465582035189825,"1":0.01915959440605813,"2":0.05979623306186263,"3":0.016060172657688016,"4":-0.01692744593621205,"5":-0.12277653472973168,"6":-0.0006946142740114409,"7":-0.10644244838115875,"8":0.058687836243825224,"9":0.017434985817503794,"10":0.06514536205097887,"11":-0.01202672926658079,"12":-0.017512173476737492,"13":-0.10665837147507534,"14":0.09834650346328172,"15":-0.07384486364610089,"16":-0.04115378553911847,"17":-0.04518371536878558,"18":0.08487804228313199,"19":-0.03749556417509845,"20":-0.038361006320974604,"21":-0.023511019576812245,"22":0.1491500313186507,"23":-0.04181737804019854,"24":0.14465595664989578,"25":0.04192227024222871,"26":-0.04197788794224975,"27":0.002180523453531744,"28":0.015230002139409558,"29":-0.0822929498444976,"30":-0.04862799788214046,"31":0.03247460444114984,"32":0.029200430932365542,"33":-0.044020217797472734,"34":0.025025972918044273,"35":0.03968337194577524,"36":0.04630488315816674,"37":0.06084044098710037,"38":0.13011583081252784,"39":0.05242727849928202,"40":0.0013220553042599251,"41":0.029470654457714122,"42":-0.0248103573210443,"43":-0.12201636033142754,"44":-0.016003361776729525,"45":-0.09911568398219278,"46":0.03392756948016007,"47":-0.04675299541069719,"48":0.06794575236470318,"49":0.052504374791701135,"50":-0.07770237616674057,"51":0.0038565312662318277,"52":-0.04219127458556544,"53":0.017677588260878844,"54":0.018268208969211306,"55":-0.0077943027601317695,"56":0.023560588536981324,"57":-0.04043807472476477,"58":-0.08105438523006359,"59":0.04232981390082921,"60":0.0607919241158488,"61":0.0024574701404081927,"62":-0.047360705439368024,"63":0.0569374656177313,"64":0.014464568328140484,"65":0.028118768098244602,"66":0.019332752286562033,"67":-0.060132249363522544,"68":0.020074892506798902,"69":-0.055341620460860615,"70":-0.028239059037376897,"71":0.13380398170927776,"72":-0.020793443096051578,"73":0.03037820695187748,"74":0.06633296072992731,"75":-0.08214674449440432,"76":-0.001955857802783074,"77":-0.08241797554372839,"78":-0.06392544525853879,"79":-0.025720376365465075,"80":0.016513651490228397,"81":0.04028714863432271,"82":0.06923190888255713,"83":0.06519042551490399,"84":0.08496099420165644,"85":0.039736554412429605,"86":0.0079076114085085,"87":-0.03577927119434848,"88":-0.09091908835240027,"89":-0.01485665283767194,"90":-0.04090856341823796,"91":-0.040901782764491475,"92":-0.01983179015396493,"93":0.1127848709384567,"94":0.05711817509937753,"95":-0.03509786871563153,"96":0.00910896053360917,"97":-0.056081757999763976,"98":-0.07013388171765197,"99":0.14882950628464356,"100":-0.030134164528838315,"101":-0.005631712801984282,"102":0.0171150657007246,"103":-0.0653834302551644,"104":0.04527095384194277,"105":-0.050130855541515605,"106":0.009490075096501484,"107":-0.04933311355602671,"108":-0.06393709274812989,"109":-0.051917336174518124,"110":0.01735864705768234,"111":0.06319825158086952,"112":0.08887351090522456,"113":0.1610149620957305,"114":0.025085925571994572,"115":-0.057078940235231225,"116":-0.06578346418932947,"117":-0.07420694056333303,"118":-0.0038251868275994854,"119":-0.03923339725512001,"120":0.01602411731396746,"121":-0.005223994258446928,"122":-0.04019732095532417,"123":-0.0216624855227417,"124":0.0571739748004211,"125":0.0676923195742667,"126":-0.004033697197913354,"127":-0.00349078473829619,"128":0.005479423922541834,"129":-0.04764387323198994,"130":0.03315393713633964,"131":-0.04619323464560143,"132":-0.06381868198058416,"133":-0.022365052158892108,"134":-0.04587624293296214,"135":-0.06421581582965337,"136":-0.09949128550852065,"137":0.0031080716937720116,"138":0.09466422237358199,"139":0.019691710352588952,"140":0.09420939958578987,"141":0.053691082972541604,"142":0.01913863545888522,"143":-0.01766716748855527,"144":0.10294567629259946,"145":-0.01589499234708753,"146":0.05610168164775273,"147":-0.06508482022190762,"148":0.005132531547658516,"149":0.011081912826002523,"150":-0.08251439392683886,"151":0.022686523370156933,"152":0.02082632935832192,"153":-0.03738320595410079,"154":0.14287423753416179,"155":-0.017423945901955003,"156":-0.08069472767580459,"157":0.05308600594470878,"158":-0.028064601931665465,"159":-0.018146770216998873,"160":-0.03674457370775587,"161":-0.07311723401658263,"162":-0.02087162210347125,"163":-0.09569541453911712,"164":-0.07030955524737081,"165":-0.017638790017511057,"166":0.045550954599183145,"167":0.09590258183379062,"168":-0.049132013285693145,"169":0.06999591844413039,"170":0.034637158026314195,"171":0.05443917496702805,"172":-0.02860594843017543,"173":-0.04644810265116198,"174":-0.02609596827405642,"175":-0.14034958314138243,"176":0.11725826793919299,"177":-0.04570250420007708,"178":-0.039217887945653215,"179":-0.12274763978937375,"180":-0.02092070216783132,"181":0.03698920304095566,"182":0.12343302865665227,"183":0.07744611761219543,"184":0.06205558078605479,"185":0.015317491324486022,"186":-0.09428430294067627,"187":0.003923582889218189,"188":-0.03803428029571681,"189":0.04473476698349277,"190":-0.0510316549113223,"191":-0.10403460536787154,"192":-0.039802810094110366,"193":-0.07641688541549181,"194":0.030015353188728774,"195":0.0006970556525917902,"196":-0.0027370892290200224,"197":-0.12489744756328844,"198":-0.02739954976478516,"199":-0.05177407547513901,"200":-0.06739230103351602,"201":0.0626099566822766,"202":-0.07998268091141926,"203":0.02956363691292858,"204":-0.05072722064903311,"205":-0.06436161688278076,"206":-0.00020677209309377315,"207":-0.04924350377674572,"208":-0.019784900680634494,"209":-0.020313385376227632,"210":0.029613712064010835,"211":0.0040677819416844695,"212":0.07754011985591729,"213":0.03920679348507261,"214":0.007059050131767607,"215":0.020392655193877406,"216":0.06349050788168896,"217":0.03689889778912287,"218":0.004011654946657711,"219":-0.06582297059024121,"220":-0.027981391466544794,"221":0.10220953812734017,"222":0.006553276032989892,"223":0.01595890107521779,"224":0.03145743311592276,"225":-0.0584145187688504,"226":-0.0031917442975895986,"227":-0.08899767195453721,"228":-0.01738273364189349,"229":0.031114467726416673,"230":-0.006394846353364438,"231":0.05355961059552875,"232":0.06426409575205624,"233":0.07929806017542997,"234":0.06383948154819742,"235":0.06050464768151699,"236":0.04184272210888377,"237":0.05731510130330699,"238":-0.033155697224900534,"239":-0.1224880269982704,"240":0.053372904027318445,"241":-0.038727916051418745,"242":0.019408703239175974,"243":0.0040027509848416035,"244":-0.04154171599710827,"245":-0.0067018091610472645,"246":-0.03723862147002827,"247":-0.054599604398941126,"248":-0.000021041766855361456,"249":-0.060532136925809464,"250":-0.08581995504690258,"251":0.038310334893594256,"252":-0.02297239389729122,"253":0.02207695919553653,"254":0.039934323736182345,"255":-0.08025827917852935,"256":0.12562779089677586,"257":-0.07421471377897354,"258":0.08408559191508208,"259":0.017388269354662287,"260":-0.019587784444101176,"261":0.059734716461257886,"262":-0.056873102251880976,"263":-0.13037627049280706,"264":0.03892421235057238,"265":-0.056956352038064914,"266":-0.09584154878962439,"267":0.03013638398986909,"268":-0.0011323863219251087,"269":0.003894047026236928,"270":0.036555837763734104,"271":0.1071553232000261,"272":0.047078942418820366,"273":0.04696308488755352,"274":0.026772021046043922,"275":0.01663067905142248,"276":-0.0023690931983173526,"277":0.029489839731768153,"278":-0.06581450533306336,"279":-0.054350642745804235,"280":-0.037999774060700445,"281":-0.07852716091685628,"282":-0.03439654982240467,"283":0.027885269746708408,"284":-0.04008420601126438,"285":0.018775105455698094,"286":0.03252326226427088,"287":-0.008972521753406383,"288":-0.01631788579720025,"289":-0.02533443829659376,"290":-0.014617474618219219,"291":-0.010063165790773999,"292":0.04839271772898452,"293":-0.061284841545224615,"294":0.04277490860812817,"295":-0.04874649609056193,"296":0.11716812755356451,"297":-0.04429818923910463,"298":0.0013788097402276218,"299":-0.004821183339636203,"300":0.06377968225393889,"301":0.04872756645691361,"302":-0.06226793505165471,"303":-0.07083842749404337,"304":-0.016612383256106717,"305":0.00789718697037367,"306":-0.07297729884630373,"307":0.00034057840835382896,"308":0.07539571361186355,"309":0.027610962610562114,"310":0.07189420976526946,"311":0.014663292792580171,"312":-0.02219644544827622,"313":0.005410662837961135,"314":-0.05084865428921088,"315":-0.027178336977632177,"316":0.08948348096832251,"317":0.039197704864603444,"318":-0.024567116443739132,"319":0.03706352829965942,"320":0.13365040638384285,"321":0.025701655377793647,"322":0.031956862803004464,"323":-0.0561765207911684,"324":-0.08751263488565987}}],"biases":{"sx":1,"sy":1,"depth":1,"w":{"0":0}}},{"out_depth":5,"out_sx":1,"out_sy":1,"layer_type":"fc","num_inputs":1,"l1_decay_mul":0,"l2_decay_mul":1,"filters":[{"sx":1,"sy":1,"depth":1,"w":{"0":0.518081900917661}},{"sx":1,"sy":1,"depth":1,"w":{"0":-2.321902117290021}},{"sx":1,"sy":1,"depth":1,"w":{"0":-0.06087709473602826}},{"sx":1,"sy":1,"depth":1,"w":{"0":0.9372804804962301}},{"sx":1,"sy":1,"depth":1,"w":{"0":0.22601533467000431}}],"biases":{"sx":1,"sy":1,"depth":5,"w":{"0":0,"1":0,"2":0,"3":0,"4":0}}},{"out_depth":5,"out_sx":1,"out_sy":1,"layer_type":"regression","num_inputs":5}]});
}