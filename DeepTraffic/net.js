
//<![CDATA[

// a few things don't have var in front of them - they update already existing variables the game needs
lanesSide = 2;
patchesAhead = 10;
trainIterations = 10000;

// the number of other autonomous vehicles controlled by your network
otherAgents = 3; // max of 9

var num_inputs = (lanesSide * 2 + 1) * (patchesAhead + patchesBehind);
var num_actions = 5;
var temporal_window = 5;
var network_size = num_inputs * temporal_window + num_actions * temporal_window + num_inputs;

var layer_defs = [];
    layer_defs.push({
    type: 'input',
    out_sx: 1,
    out_sy: 1,
    out_depth: network_size
});
layer_defs.push({
    type: 'fc',
    num_neurons: 1,
    activation: 'softmax'
});
layer_defs.push({
    type: 'regression',
    num_neurons: num_actions
});

var tdtrainer_options = {
    learning_rate: 0.01,
    momentum: 0,
    batch_size: 32,
    l2_decay: 0.001
};

var opt = {};
opt.temporal_window = temporal_window;
opt.experience_size = 8000;
opt.start_learn_threshold = 500;
opt.gamma = 0.7;
opt.learning_steps_total = 10000;
opt.learning_steps_burnin = 1000;
opt.epsilon_min = 0.0;
opt.epsilon_test_time = 0.0;
opt.layer_defs = layer_defs;
opt.tdtrainer_options = tdtrainer_options;

brain = new deepqlearn.Brain(num_inputs, num_actions, opt);

learn = function (state, lastReward) {
brain.backward(lastReward);
var action = brain.forward(state);

draw_net();
draw_stats();

return action;
}

//]]>

/*###########*/
if (brain) {
brain.value_net.fromJSON({"layers":[{"out_depth":535,"out_sx":1,"out_sy":1,"layer_type":"input"},{"out_depth":1,"out_sx":1,"out_sy":1,"layer_type":"fc","num_inputs":535,"l1_decay_mul":0,"l2_decay_mul":1,"filters":[{"sx":1,"sy":1,"depth":535,"w":{"0":0.00006896303495456798,"1":0.011745890741175415,"2":-0.012417369157593557,"3":0.05433207840188684,"4":0.01782329332280946,"5":0.03853592745185267,"6":-0.019217513520562838,"7":0.05271864144592782,"8":0.01684104249585141,"9":-0.05639641908270947,"10":0.07299436605401813,"11":-0.01414420365352162,"12":0.03059102454567599,"13":-0.07114903866880604,"14":0.048622071597581924,"15":0.0022637658477052134,"16":-0.0339871459939253,"17":-0.047046657317996454,"18":-0.07309101818827526,"19":-0.010715491263409184,"20":-0.006151136036420659,"21":0.02269743555853735,"22":-0.004432018265299201,"23":-0.026477943389836733,"24":-0.06863197764549761,"25":-0.01855340830007604,"26":-0.020314004752567866,"27":0.043505602600283855,"28":0.025240707642342246,"29":0.00249619024533405,"30":-0.011771465219188138,"31":-0.03385532337533468,"32":-0.027744052355525673,"33":-0.02227566501748947,"34":0.0064928796573476555,"35":0.0230067941624756,"36":0.0472277336935395,"37":0.009886921268185743,"38":-0.0680638786346423,"39":-0.02828600543886553,"40":-0.04132525662426902,"41":-0.025631574446211464,"42":0.0760656446712116,"43":0.02877972331702677,"44":0.06796185166476744,"45":0.010657109533405314,"46":0.008957445246350483,"47":-0.06830560484467761,"48":-0.008759997556780821,"49":-0.023469249147455618,"50":0.050987797661221274,"51":0.025747284972224487,"52":-0.01471784234760718,"53":0.032119491590740505,"54":-0.015435096532565707,"55":-0.012908631267752529,"56":-0.00770632059766797,"57":0.04388288778566618,"58":-0.03614851074185955,"59":0.022421625094000634,"60":0.029726258304499736,"61":0.05345120836519889,"62":0.01121928762783417,"63":-0.007313662148304872,"64":-0.10293909160483439,"65":-0.013315262857855425,"66":0.02681980088239492,"67":0.03668546199005001,"68":0.04905927944929366,"69":-0.015863026241836293,"70":0.0134844791608936,"71":-0.005866464429645858,"72":-0.054018838874924445,"73":-0.0576346011179954,"74":0.047132543179235424,"75":0.013874401673070785,"76":-0.03713084598410959,"77":-0.080022350839581,"78":-0.027209079014421444,"79":0.05302234632335432,"80":-0.025351033991076043,"81":0.037826343481438214,"82":0.06841084386469426,"83":0.05437902978193301,"84":0.031084113657576753,"85":0.011986919463626993,"86":0.025720736855886443,"87":0.1319789341702895,"88":-0.013041028297856526,"89":-0.04264845974584226,"90":0.017556035220848715,"91":-0.02001800781013871,"92":-0.014724185955052208,"93":-0.052076344361379825,"94":0.03389356302598199,"95":0.018501292384425133,"96":-0.004163692491914757,"97":-0.04608557411411241,"98":-0.011288246618403303,"99":-0.08403046640587188,"100":-0.06484236804938814,"101":0.04912460548106053,"102":-0.0747187432490336,"103":0.0020751751158027947,"104":-0.020509406850945485,"105":-0.06413033347033206,"106":-0.05617347534570959,"107":-0.03554052331119604,"108":-0.009964103175947191,"109":0.002212488541466815,"110":0.05808944357180884,"111":-0.07304665002319834,"112":-0.005804804266316181,"113":-0.06790738076182057,"114":-0.008707025406276717,"115":-0.04566201189517015,"116":0.023573189627419507,"117":0.04654359940663305,"118":0.015187756860508555,"119":0.0030968023716219993,"120":0.08094911546208862,"121":0.019768838888323342,"122":-0.045025547774085496,"123":0.021737898785562967,"124":0.038805856429821706,"125":-0.01644553994196791,"126":-0.028249062079709772,"127":-0.032561056448324306,"128":0.07380272724120837,"129":-0.0023549112004375874,"130":0.08276253291279043,"131":0.08846165605255664,"132":0.0036965413358171924,"133":0.04712535760841735,"134":0.02503750757739757,"135":-0.04385788095098966,"136":-0.03182411252643969,"137":-0.04483435794253943,"138":0.08428997937739784,"139":0.01036348007118052,"140":-0.005269590726623979,"141":0.010942302380465563,"142":0.052423403085511154,"143":0.01599720515940434,"144":-0.019034083217280152,"145":0.03054115896694104,"146":-0.010150795815798289,"147":-0.013917255943000518,"148":0.0240354073738371,"149":-0.021580742174354923,"150":-0.06862741950600597,"151":0.08102273862332622,"152":-0.012845350077328045,"153":-0.02318158367527362,"154":-0.10842038849922798,"155":0.01230270214100123,"156":0.0261644182342527,"157":-0.028054869192988184,"158":0.022937014385579216,"159":-0.009675165583510283,"160":-0.11439148427439985,"161":-0.01764349852596867,"162":-0.012582182681069119,"163":0.018910765212104278,"164":-0.04965949313740944,"165":-0.035348185955142726,"166":0.032943735910274684,"167":-0.08440341629614243,"168":0.021114310359722974,"169":-0.011770249831818999,"170":-0.04540450075070803,"171":0.008032715925652517,"172":-0.07999373696162998,"173":-0.049942794683518664,"174":0.05210363209760258,"175":0.026262810171455663,"176":0.029057842481257878,"177":-0.08754585459840321,"178":-0.0245401340662986,"179":0.032233966125236074,"180":0.008460580179627834,"181":-0.031760363904611795,"182":-0.01651444656592649,"183":-0.08016000004872915,"184":0.05037261515638132,"185":-0.03931786711854898,"186":-0.013506232765648786,"187":-0.044845326667882685,"188":0.037387741710839244,"189":-0.05636594042386224,"190":0.08605132599267051,"191":0.09057616217193924,"192":0.04343869893123141,"193":-0.006687121924718917,"194":-0.0012704805272883036,"195":0.014874379848544898,"196":-0.07287258661095362,"197":0.010472133298009351,"198":0.09526811817741695,"199":-0.044184957924802176,"200":0.008095178637200724,"201":-0.03564068759196937,"202":-0.019934016377327717,"203":0.00013092280927362492,"204":0.08529115380168618,"205":0.06847339592797055,"206":0.06371361480340056,"207":0.02186608431258063,"208":-0.00906873155234199,"209":0.04561754746218695,"210":0.029463218767879433,"211":-0.005614894534934957,"212":0.01898889446890686,"213":-0.00909869817639245,"214":-0.041017141123090774,"215":0.033131521854601866,"216":0.034330139768543,"217":0.04350751638253299,"218":0.022529747874843166,"219":0.0673445729658282,"220":-0.004662760905535772,"221":0.09160331451462415,"222":0.019232790291306482,"223":-0.05668202192619158,"224":-0.02930234678073744,"225":-0.015296123287132226,"226":-0.004802153151010362,"227":0.039318292059894525,"228":-0.03411161117261167,"229":0.04701985401776429,"230":-0.07685776796554256,"231":0.00004808183872934689,"232":0.012437674059919428,"233":0.0683750710830651,"234":0.07724629216148589,"235":-0.04043329155039,"236":-0.032913488408044,"237":0.027586634109743612,"238":-0.05399434425815161,"239":0.014690346820200489,"240":-0.10086081612194266,"241":-0.013699662798175744,"242":-0.04355893679428667,"243":-0.016123569428449527,"244":-0.009427461017492478,"245":-0.01059175495964488,"246":0.025894588273424113,"247":-0.0409061787657399,"248":0.05229508035646332,"249":-0.028118160353120508,"250":0.09671321212756791,"251":0.05437903512473728,"252":-0.0344471420013721,"253":-0.006938972717851704,"254":0.024446348865359523,"255":-0.0032838788802372508,"256":-0.05281886166712891,"257":0.011898488051530936,"258":-0.03146159431817235,"259":0.08652026441919859,"260":-0.13920151935253078,"261":0.007094472511162122,"262":-0.021808180647264048,"263":0.005542926481633047,"264":-0.04147693748095898,"265":-0.06074160047364724,"266":0.048525673483644054,"267":0.01917373449128424,"268":-0.01815739691067978,"269":0.039554762855216266,"270":-0.059289531769496966,"271":0.04054128628738051,"272":0.016098907202946884,"273":-0.029421375471257925,"274":-0.03714364918248712,"275":-0.12435615802605274,"276":0.05080317497904942,"277":-0.013765333830747866,"278":-0.04067688695676854,"279":-0.024194375152820375,"280":-0.05395529188143542,"281":0.11200200725375777,"282":-0.011852690152910895,"283":0.03930354878400044,"284":0.013490114969814093,"285":0.026850616429474262,"286":-0.0005450102118405063,"287":-0.03496470621657859,"288":-0.0512632889859073,"289":-0.03440025890475988,"290":-0.022621309198103328,"291":-0.0416856417520894,"292":0.020565795525037536,"293":0.10053324917452128,"294":-0.044200500105015146,"295":-0.044442093829197254,"296":-0.08158066861621596,"297":-0.02276374601222341,"298":0.08199524942005758,"299":0.007177997172695608,"300":0.05450755114518247,"301":-0.008348481834823044,"302":-0.0020318881901129383,"303":-0.021254021828731727,"304":0.0815521920212949,"305":-0.07700157125350272,"306":0.008550443369569706,"307":-0.034030320653553624,"308":0.025981882605030145,"309":0.0893192974479773,"310":-0.06117450026446771,"311":-0.02837102522785596,"312":-0.07673188416599135,"313":0.02531660174626639,"314":-0.022817527684139985,"315":0.05266055758833259,"316":-0.05203830127143196,"317":0.08078391436834237,"318":0.04294308659035077,"319":-0.06718252548065305,"320":0.009786651051753033,"321":-0.012969954984878431,"322":-0.013328572891642227,"323":0.06568651460709646,"324":0.051095133837314094,"325":-0.019776590566729237,"326":0.03619701181571571,"327":-0.02404865016749701,"328":-0.04573043043886068,"329":0.08100228896846709,"330":0.015249126208607014,"331":0.061144153137336336,"332":-0.04470680215268746,"333":-0.041934015328755424,"334":-0.053399714242097204,"335":0.026392846677708012,"336":0.020298440764572896,"337":0.028719618728202695,"338":-0.012357048085141318,"339":-0.01291713815525425,"340":0.06083468923241713,"341":0.04696870503539353,"342":-0.013050469980193328,"343":-0.02649405045244834,"344":-0.017730486100890123,"345":-0.011674989727154991,"346":0.03902043692718011,"347":0.029837945518083817,"348":0.06873734844091645,"349":-0.04002368673056675,"350":-0.01858243444469796,"351":0.033017121882333585,"352":-0.03730440974661889,"353":-0.01231064518649755,"354":0.00321784793108066,"355":-0.0034622826256484173,"356":-0.027400344836665327,"357":0.014500805328902393,"358":0.001945165775266982,"359":0.011212410634977625,"360":-0.03017603067102846,"361":-0.09021994904743302,"362":0.0010936948897423417,"363":-0.05530763917362045,"364":0.05074702741416834,"365":0.009950723296100502,"366":-0.05219645413031858,"367":-0.03629821380835858,"368":-0.013731569242876392,"369":0.047398368992638495,"370":0.010133417216139374,"371":-0.10177101011175216,"372":0.06453898692292684,"373":0.029712065420128917,"374":0.0003135248237302718,"375":0.13793894835673504,"376":0.012045648055942475,"377":0.0004974685543114924,"378":0.029710951763289813,"379":-0.06406269177336925,"380":-0.05627416840808765,"381":-0.027307897530144,"382":-0.025385504165257866,"383":-0.037533286083305466,"384":0.0303002806587465,"385":0.00027760757159736533,"386":0.049127034901051324,"387":0.049292635310658126,"388":-0.0028283019335035857,"389":-0.0188212512699858,"390":0.02660909673115016,"391":-0.032382749000994734,"392":0.0056893344506790755,"393":-0.012533991434631183,"394":0.05382372916406424,"395":-0.018009017072867905,"396":-0.03489813353600315,"397":-0.004313732111175958,"398":0.05439311687462771,"399":0.01721440453215479,"400":0.01259419485426569,"401":-0.05436763717650109,"402":-0.05962441989515174,"403":-0.005292789881915945,"404":-0.06837566104581422,"405":-0.02483541192011477,"406":0.07358860566728824,"407":-0.012676034830060324,"408":0.050971526858482975,"409":0.03777356701518908,"410":0.011217067366114693,"411":-0.04325286646886272,"412":-0.008604651306503617,"413":0.05788836719164093,"414":-0.005234757662347584,"415":-0.0460057768484882,"416":0.03509782135131754,"417":-0.01662405896888663,"418":0.09732627189423695,"419":0.0653895623481975,"420":0.05506018356353402,"421":-0.00086506752804328,"422":-0.020769413783737346,"423":-0.029180050381608136,"424":-0.008332688498377594,"425":0.012535175365723664,"426":-0.03690354007214837,"427":0.0108973656371911,"428":-0.029309424251020285,"429":-0.01477890847705381,"430":0.024838411878508646,"431":-0.004196632088607603,"432":0.04069842370709008,"433":0.028099561287947876,"434":0.041861377605898586,"435":-0.06361460860022936,"436":-0.03692816072018331,"437":0.014749884254240354,"438":0.012431549301953948,"439":0.016866083472327955,"440":-0.0016555956100815998,"441":0.031233676000882223,"442":0.04850703969912419,"443":0.05263594851478093,"444":0.03630455718441812,"445":-0.040481887735660436,"446":-0.0002555383221924225,"447":0.04882515615631006,"448":-0.011366484387246842,"449":-0.06945499724563128,"450":-0.01389411759585823,"451":-0.10787958863616458,"452":-0.07190956665704092,"453":0.019699256779435743,"454":-0.038831122187908684,"455":-0.015095361419974246,"456":-0.07226289120128114,"457":0.007359913390732926,"458":-0.019682930773695644,"459":-0.038509825293128394,"460":-0.012456162149646509,"461":-0.03699455208396868,"462":-0.05572626408821959,"463":-0.0019640637613394297,"464":0.08505735434338357,"465":0.04453161052683307,"466":0.10699325531958974,"467":-0.03224970817924651,"468":0.06690059487600619,"469":-0.04023405419686464,"470":0.0727514417618582,"471":0.036648305335744175,"472":-0.01672951351355995,"473":-0.01813687179566789,"474":0.0015043752877879318,"475":0.019364120796177997,"476":0.08367586274641645,"477":-0.016557708163653675,"478":-0.004842891705379328,"479":-0.005392199442053125,"480":-0.07776693358983919,"481":0.009148145300337245,"482":-0.013119833222889782,"483":0.03327895614698987,"484":0.08844123342392715,"485":0.00010080257858277434,"486":0.029490750194611372,"487":-0.013555764032981015,"488":0.05493014746444535,"489":0.012409200906687614,"490":-0.036758215688824404,"491":-0.012807020504169741,"492":0.04508515488652059,"493":0.010797586604442435,"494":-0.014353461376321907,"495":-0.010236146893965684,"496":0.0033836642792722266,"497":0.04183926644437659,"498":0.007218465659269392,"499":-0.023083064938213133,"500":-0.06426009169058877,"501":-0.04952976914665136,"502":-0.0011026625687649712,"503":0.05229587605219555,"504":-0.07132225054652347,"505":0.021337140143550648,"506":0.05713055868810558,"507":0.04066118933259989,"508":0.016115686479412365,"509":0.05408611821445054,"510":0.01964236559579625,"511":0.039341751232948925,"512":0.09497515068266534,"513":0.053952663816939785,"514":-0.00015388821464381775,"515":-0.01659116704898489,"516":-0.06271273685224074,"517":-5.509716957763009e-8,"518":-0.034661936233312554,"519":0.07572853038127302,"520":-0.008362565938416559,"521":-0.009529098588646985,"522":-0.00757584973824475,"523":0.032443793671046176,"524":0.07850285959952444,"525":-0.008314436670563531,"526":-0.08394577670155819,"527":-0.09170342426630305,"528":0.03379333831736747,"529":-0.06435078313082061,"530":0.05612878024258257,"531":0.025174146285359276,"532":-0.01575267486641087,"533":0.014384589895923701,"534":-0.043483089027130245}}],"biases":{"sx":1,"sy":1,"depth":1,"w":{"0":0}}},{"out_depth":5,"out_sx":1,"out_sy":1,"layer_type":"fc","num_inputs":1,"l1_decay_mul":0,"l2_decay_mul":1,"filters":[{"sx":1,"sy":1,"depth":1,"w":{"0":-1.1946972404576661}},{"sx":1,"sy":1,"depth":1,"w":{"0":-0.8773120269190043}},{"sx":1,"sy":1,"depth":1,"w":{"0":0.4735494486536298}},{"sx":1,"sy":1,"depth":1,"w":{"0":0.6350029554923132}},{"sx":1,"sy":1,"depth":1,"w":{"0":0.5708050234883097}}],"biases":{"sx":1,"sy":1,"depth":5,"w":{"0":0,"1":0,"2":0,"3":0,"4":0}}},{"out_depth":5,"out_sx":1,"out_sy":1,"layer_type":"regression","num_inputs":5}]});
}